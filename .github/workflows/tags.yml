name: tags
on: push
jobs:
  install:
    runs-on: ubuntu-20.04
    steps:
      - name: Check out code ðŸ›Ž
        uses: actions/checkout@v2
      - name: Install dependencies ðŸ“¦
        uses: cypress-io/github-action@v2
        with:
          # just perform install
          runTests: false

  tag-dynamic:
    runs-on: ubuntu-20.04
    needs: install
    steps:
      - name: Checkout ðŸ›Ž
        uses: actions/checkout@v2

      # https://github.com/cypress-io/github-action
      - name: Run tests ðŸ§ª
        uses: cypress-io/github-action@v2
        with:
          start: npm run dev
          wait-on: 'http://localhost:1234'
          env: grepTags=@dynamic,grepFilterSpecs=true
          record: true
          group: '1 - @dynamic'
          tag: tags
        env:
          # pass the Dashboard record key as an environment variable
          CYPRESS_RECORD_KEY: ${{ secrets.CYPRESS_RECORD_KEY }}

  tag-visible:
    runs-on: ubuntu-20.04
    needs: install
    steps:
      - name: Checkout ðŸ›Ž
        uses: actions/checkout@v2

      # https://github.com/cypress-io/github-action
      - name: Run tests ðŸ§ª
        uses: cypress-io/github-action@v2
        with:
          start: npm run dev
          wait-on: 'http://localhost:1234'
          env: grepTags=@visible,grepFilterSpecs=true
          record: true
          group: '2 - @visible'
        env:
          # pass the Dashboard record key as an environment variable
          CYPRESS_RECORD_KEY: ${{ secrets.CYPRESS_RECORD_KEY }}

  tag-client:
    runs-on: ubuntu-20.04
    needs: install
    steps:
      - name: Checkout ðŸ›Ž
        uses: actions/checkout@v2

      # https://github.com/cypress-io/github-action
      - name: Run tests ðŸ§ª
        uses: cypress-io/github-action@v2
        with:
          start: npm run dev
          wait-on: 'http://localhost:1234'
          env: grepTags=@client,grepFilterSpecs=true
          record: true
          group: '3 - @client'
        env:
          # pass the Dashboard record key as an environment variable
          CYPRESS_RECORD_KEY: ${{ secrets.CYPRESS_RECORD_KEY }}

  tag-intercept:
    runs-on: ubuntu-20.04
    needs: install
    steps:
      - name: Checkout ðŸ›Ž
        uses: actions/checkout@v2

      # https://github.com/cypress-io/github-action
      - name: Run tests ðŸ§ª
        uses: cypress-io/github-action@v2
        with:
          start: npm run dev
          wait-on: 'http://localhost:1234'
          env: grepTags=@intercept,grepFilterSpecs=true
          record: true
          group: '4 - @intercept'
        env:
          # pass the Dashboard record key as an environment variable
          CYPRESS_RECORD_KEY: ${{ secrets.CYPRESS_RECORD_KEY }}

  untagged:
    runs-on: ubuntu-20.04
    needs: [tag-intercept, tag-client, tag-visible, tag-dynamic]
    steps:
      - name: Checkout ðŸ›Ž
        uses: actions/checkout@v2

      # https://github.com/cypress-io/github-action
      - name: Run tests ðŸ§ª
        uses: cypress-io/github-action@v2
        with:
          start: npm run dev
          wait-on: 'http://localhost:1234'
          env: grepUntagged=true
          record: true
          group: '5 - untagged'
        env:
          # pass the Dashboard record key as an environment variable
          CYPRESS_RECORD_KEY: ${{ secrets.CYPRESS_RECORD_KEY }}
